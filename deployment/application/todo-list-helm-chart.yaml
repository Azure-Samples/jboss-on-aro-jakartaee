build:
  uri: https://github.com/Azure-Samples/jboss-on-aro-jakartaee.git
  ref: bootable-jar-openshift
  mode: bootable-jar
  bootableJar:
    builderImage: registry.access.redhat.com/ubi8/openjdk-17:1.14
  env:
    - name: MAVEN_ARGS_APPEND
      value: -Pbootable-jar-openshift
    - name: MSSQLSERVER_DRIVER_VERSION
      valueFrom:
        secretKeyRef:
          key: app-driver-version
          name: todo-list-secret
deploy:
  replicas: 3
  env:
    - name: KUBERNETES_NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
    - name: JGROUPS_CLUSTER_PASSWORD
      valueFrom:
        secretKeyRef:
          key: app-cluster-password
          name: todo-list-secret
    - name: MSSQLSERVER_JNDI
      valueFrom:
        secretKeyRef:
          key: app-ds-jndi
          name: todo-list-secret
    - name: MSSQLSERVER_HOST
      valueFrom:
        secretKeyRef:
          key: db-host
          name: mssqlserver-secret
    - name: MSSQLSERVER_DATABASE
      valueFrom:
        secretKeyRef:
          key: db-name
          name: mssqlserver-secret
    - name: MSSQLSERVER_PASSWORD
      valueFrom:
        secretKeyRef:
          key: db-password
          name: mssqlserver-secret
    - name: MSSQLSERVER_PORT
      valueFrom:
        secretKeyRef:
          key: db-port
          name: mssqlserver-secret
    - name: MSSQLSERVER_USER
      valueFrom:
        secretKeyRef:
          key: db-user
          name: mssqlserver-secret
